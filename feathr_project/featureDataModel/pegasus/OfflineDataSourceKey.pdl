namespace com.linkedin.proml.mlFeatureAnchor.key

import com.linkedin.proml.mlFeatureAnchor.common.MvelExpression
import com.linkedin.proml.mlFeatureAnchor.common.SparkSqlExpression
import com.linkedin.proml.mlFeatureAnchor.common.UserDefinedFunction

/**
 * Represents a feature's key that is extracted from each row of an offline data source and is used to join with observation data to form a training dataset. This class is expected to be included so the definitions of enclosed fields can be reused.
 */
record OfflineDataSourceKey {

  /**
   * Key function specifies how to extract the feature's key from each row of the offline data source. For example, an offline dataset has memberUrn field, a key function being defined as getIdFromUrn(memberUrn) means the feature key is a numeric member id, which can later be used to join with observation data that also has numeric member id column. A feature's key can have one key part or multiple key parts (compound key). This field should be required, keeping it optional for fulfilling backward compatiblity requirement during schema evolution. For more details, refer to https://iwww.corp.linkedin.com/wiki/cf/display/ENGS/Frame+Offline+User+Guide#FrameOfflineUserGuide-KeyExtraction.
   */
  keyFunction: optional union[
    //MVEL-based key function. It can either be a simple reference to a field name in the offline dataset, or apply some trasformations on top of some columns.
    MvelExpression

    //SparkSql-based key function. Note this is experimental and can be deprecated in near future.
    SparkSqlExpression

    //UDF-based key function. It is useful when key function can't be written easily with an expression language like MVEL. For more details, refer to SourceKeyExtractor interface in above doc link.
    UserDefinedFunction
  ]
}